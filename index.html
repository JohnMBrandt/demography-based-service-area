<html>
	<head>

	  <!-- load in required CSS and JavaScript libraries -->

	  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" />
	  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
	  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	  <link rel="stylesheet" href="lib/css/L.Control.Locate.scss" />
		
	  <script type="text/javascript" src="lib/js/ol.js"></script>
	  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	  <script src="https://unpkg.com/leaflet@1.0.0-rc.3/dist/leaflet.js"></script>
	  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	  <script src="https://cartodb-libs.global.ssl.fastly.net/cartodb.js/v3/3.15/cartodb.js"></script>
	  <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
	  <script src="lib/js/L.Control.Locate.min.js"></script>

		<title> Public Resource Mapper </title>

		<!-- Set the dimensions for the map container -->

		<style media="screen">
    		html,body,#map{
      		width: 99%;
      		height: 99%;
    		}
    	</style>
	</head>

	<body>
		<div id="map"></div>

		<script>
		
			// Begin javascript to define the interactive map

			// Create the map, set it's initial coordinates, and create a base layer
			var coor = [42.72, -75.3]        
			var m = L.map('map', {zoomControl:false}).setView(coor, 7);
			var mq=L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png', {attribution: 'CartoDB | OSRM'});
			mq.addTo(m);

			// Create a function that creates a button
			function createButton(label, container) {
			    var btn = L.DomUtil.create('button', '', container);
			    btn.setAttribute('type', 'button');
			    btn.innerHTML = label;
			    return btn;
			}

			/* On mouse click, call the createButton function
			and create two buttons, a "start" and a "destination" button */
			m.on('click', function(e) {
			    var container = L.DomUtil.create('div'),
			        startBtn = createButton('Start from this location', container),
			        destBtn = createButton('Go to this location', container);

			    /* when clicking the "start" button, splice the waypoints - 
			    aka remove the first (start) waypoitn and replace it with the current lat/long
			    then close the pop-up */
			    L.DomEvent.on(startBtn, 'click', function() {
        			control.spliceWaypoints(0, 1, e.latlng);
        			m.closePopup();
    			});

			   /* when clicking the "finish" button, splice the waypoints -
			   aka remove the second (destination) waypoint and replace it with the current lat/long
			   then close the pop-up */
				L.DomEvent.on(destBtn, 'click', function() {
        			control.spliceWaypoints(control.getWaypoints().length - 1, 1, e.latlng);
        			m.closePopup();
    			});
				// set the popup content to that defined above
				// with a location of the current click lat/long
    			L.popup()
			        .setContent(container)
			        .setLatLng(e.latlng)
			        .openOn(m);
			});

			var ReversablePlan = L.Routing.Plan.extend({
    			createGeocoders: function() {
        			var container = L.Routing.Plan.prototype.createGeocoders.call(this),
            			reverseButton = createButton('↑↓', container)
            		L.DomEvent.on(reverseButton, 'click', function() { 
            			var waypoints = this.getWaypoints();
            			this.setWaypoints(waypoints.reverse()); 
            		}, this);

                	return container;
    		}
			})

			// create a "plan" which contains a start and a destination
			// create a route control that takes the plan as an input
			var plan = new ReversablePlan([
  				L.latLng(),
  				L.latLng()
			]),
			control = L.Routing.control({
				routeWhileDragging: true,
				keepCurrentZoomLevel: true,
				plan: plan
			}).addTo(m);

			// create a control layer that sets the map-view to the user's current location
			var lc = L.control.locate({
    			position: 'topleft',
    			showPopup: false,
    			keepCurrentZoomLevel: true,
    			strings: {
        		title: "My Location"
    		}}).addTo(m);

		</script>
	</body>
</html>

